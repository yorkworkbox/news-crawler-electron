<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>新聞連結搜尋爬蟲</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- 新增：頂部通知容器 -->
    <div id="notificationContainer"></div>

    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="title"><svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9v-9m0-9v9"></path></svg><h1>新聞連結搜尋爬蟲</h1></div>
            <button class="theme-toggle" onclick="toggleTheme()"><svg width="16" height="16" fill="currentColor" id="theme-icon-svg"><path id="theme-icon" d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z M8 4a4 4 0 0 0-4 4 .5.5 0 0 1-1 0 5 5 0 0 1 5-5 .5.5 0 0 1 0 1z"/></svg> <span id="theme-text">淺色模式</span></button>
        </div>

        <!-- Form Section -->
        <div class="form-section">
            <div class="form-group">
                <label for="keyword">關鍵字或新聞標題</label>
                <input type="text" id="keyword" placeholder="請輸入要搜尋的關鍵字或完整新聞標題">
                <div id="keywordError" class="error-message"></div>
            </div>
            
            <div class="form-group">
                <div class="form-group-header">
                    <label>網站清單</label>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <button class="btn btn-secondary btn-small hidden" id="addNewRowBtnTop" onclick="addNewRowToActiveTab()">新增</button>
                        <button class="btn btn-primary btn-small hidden" id="saveBtn" onclick="saveTemporaryChanges()">儲存</button>
                        <button class="btn btn-secondary btn-small hidden" id="cancelBtn" onclick="exitEditMode(false)">取消</button>
                        <button class="btn btn-secondary btn-small" id="editBtn" onclick="enterEditMode()">編輯</button>
                    </div>
                </div>
                
                <div id="tabContainer" class="tab-container">
                    <div class="tab-buttons">
                        <button id="crawlTabBtn" class="tab-btn active" onclick="switchTab('crawl')">可爬取清單</button>
                        <button id="manualTabBtn" class="tab-btn" onclick="switchTab('manual')">手動清單</button>
                    </div>
                    <div class="tab-content">
                        <!-- 可爬取清單面板 -->
                        <div id="crawlTabPanel" class="tab-panel active">
                            <div id="viewModeContainer">
                                <div class="websites-header website-item">
                                    <input type="checkbox" id="selectAllCheckbox" onchange="toggleSelectAll(this.checked)"><label for="selectAllCheckbox">全選</label>
                                </div>
                                <div id="websitesContainer"></div>
                            </div>
                            <div id="editModeContainer" class="hidden">
                                <div id="websitesEditContainer"></div>
                                <div class="add-row-container">
                                    <button class="btn btn-add-row" onclick="addNewRow()">新增</button>
                                </div>
                            </div>
                        </div>
                        <!-- 手動清單面板 -->
                        <div id="manualTabPanel" class="tab-panel">
                            <div id="manualLinksContainer">
                                <div id="manualLinksList"></div>
                            </div>
                            <div id="manualEditContainer" class="hidden">
                                <div id="manualWebsitesEditContainer"></div>
                                <div class="add-row-container">
                                    <button class="btn btn-add-row" onclick="addNewManualRow()">新增</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="websiteError" class="error-message"></div>
            </div>

            <div class="button-group">
                <button class="btn btn-primary" id="searchBtn" onclick="startSearch()"><svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/></svg> <span>開始搜尋</span></button>
                <button class="btn btn-primary hidden" id="openAllBtnMain" onclick="openAllManualLinks()"><svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M8.636 3.5a.5.5 0 0 0-.5-.5H1.5A1.5 1.5 0 0 0 0 4.5v10A1.5 1.5 0 0 0 1.5 16h10a1.5 1.5 0 0 0 1.5-1.5V7.864a.5.5 0 0 0-1 0V14.5a.5.5 0 0 1-.5.5h-10a.5.5 0 0 1-.5-.5v-10a.5.5 0 0 1 .5-.5h6.636a.5.5 0 0 0 .5-.5z"/><path d="M16 .5a.5.5 0 0 0-.5-.5h-5a.5.5 0 0 0 0 1h3.793L6.146 9.146a.5.5 0 1 0 .708.708L15 1.707V5.5a.5.5 0 0 0 1 0v-5z"/></svg> <span>全部開啟</span></button>
                <button class="btn btn-secondary" onclick="loadAllLists()">重設為預設</button>
                <button class="btn btn-secondary" id="clearResultsBtn" onclick="clearResults()">清除結果</button>
                <button class="btn btn-primary hidden" id="saveAsDefaultBtn" onclick="saveToDefaultFile()">儲存成預設清單</button>
            </div>

            <div class="timed-search-section">
                <div class="timed-search-controls">
                    <label for="intervalInput">每隔</label>
                    <input type="number" id="intervalInput" value="30" min="1" class="interval-input">
                    <label for="intervalInput">分鐘 (±20%)</label>
                    <button class="btn btn-secondary" id="toggleTimedSearchBtn">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M8 3.5a.5.5 0 0 0-1 0V9a.5.5 0 0 0 .252.434l3.5 2a.5.5 0 0 0 .496-.868L8 8.71V3.5z"/><path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm7-8A7 7 0 1 1 1 8a7 7 0 0 1 14 0z"/></svg>
                        <span>定時爬取</span>
                    </button>
                </div>
                <!-- ▼▼▼ START: 新增區塊 ▼▼▼ -->
                <div class="timed-search-options">
                    <input type="checkbox" id="forceRefreshCheckbox">
                    <label for="forceRefreshCheckbox">每次重新爬取所有勾選項目 (而非僅重試失敗項目)</label>
                </div>
                <!-- ▲▲▲ END: 新增區塊 ▲▲▲ -->
                <div id="timedSearchStatus" class="timed-search-status hidden"></div>
            </div>

            <div class="debug-mode-toggle"><input type="checkbox" id="debugModeCheckbox"><label for="debugModeCheckbox">啟用除錯模式</label></div>
            <div id="progressContainer" class="hidden" style="margin-top: 20px;">
                <div id="progressText" style="text-align: center; color: var(--text-secondary); font-size: 14px; margin-bottom: 8px;"></div>
                <div class="progress-bar"><div id="progressFill" class="progress-fill"></div></div>
            </div>
        </div>
        
        <div id="resultsSection" class="results-section hidden">
            <div class="results-header">
                <div class="results-title"><svg width="20" height="20" fill="currentColor" viewBox="0 0 16 16"><path d="M10.97 4.97a.235.235 0 0 0-.02.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.061L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-1.071-1.05z"/></svg> <span>搜尋結果 -</span> <span id="resultCount"></span></div>
                <button class="btn btn-secondary btn-small" onclick="copyAllResults()">複製所有連結</button>
            </div>
            <div id="resultsContainer"></div>
        </div>

        <div class="info-panel">
            <h3>使用說明</h3>
            <ul>
                <li>在關鍵字欄位輸入要搜尋的關鍵字或完整新聞標題。</li>
                <li>**定時爬取**：預設僅會重試上次失敗或無結果的網站，以累積完整結果。若需持續監控所有網站更新，請勾選「每次重新爬取所有勾選項目」。</li>
                <li>點擊「編輯」可修改網站清單，修改後需點擊「儲存成預設清單」才會永久保存。</li>
            </ul>
        </div>

        <!-- Modals -->
        <div id="htmlModal" class="modal-overlay hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="modalTitle"></h3>
                    <button class="modal-close" onclick="closeModal('htmlModal')">×</button>
                </div>
                <div class="modal-body"><textarea id="modalContent" readonly></textarea></div>
            </div>
        </div>
        
        <div id="confirmModal" class="modal-overlay hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="confirmTitle"></h3>
                </div>
                <div class="modal-body">
                    <p id="confirmMessage"></p>
                </div>
                <div id="confirmButtons">
                    <button class="btn btn-primary" id="confirmOkBtn">確認</button>
                    <button class="btn btn-secondary" id="confirmCancelBtn">取消</button>
                </div>
            </div>
        </div>
    </div>
    <script src="renderer.js"></script>
</body>
</html>